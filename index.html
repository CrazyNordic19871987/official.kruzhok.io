<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä—É–∂–û–ö - –û—Ç–∑—ã–≤—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏ –¥–µ—Ç—Å–∫–∏—Ö –∫—Ä—É–∂–∫–æ–≤ –ú–æ—Å–∫–≤—ã</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üë®‚Äçüéì</text></svg>">
    
    <style>
        /* TripAdvisor-inspired styles */
        :root {
            --green-primary: #34E0A1;
            --green-dark: #00A870;
            --green-light: #E8F8F1;
            --gray-dark: #2D2D2D;
            --gray-medium: #585858;
            --gray-light: #F5F5F5;
            --white: #FFFFFF;
            --orange: #E67E22;
            --orange-dark: #D35400;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--white);
            color: var(--gray-dark);
            line-height: 1.4;
        }
        
        /* Header - TripAdvisor style */
        .header {
            background: var(--white);
            border-bottom: 1px solid #e0e0e0;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Updated Logo with Orange Circle */
        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            transition: transform 0.3s ease;
        }
        
        .logo:hover {
            transform: scale(1.05);
        }
        
        .logo-circle {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--orange) 0%, var(--orange-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            box-shadow: 0 4px 12px rgba(230, 126, 34, 0.4);
            border: 2px solid var(--white);
            transition: all 0.3s ease;
        }
        
        .logo:hover .logo-circle {
            box-shadow: 0 6px 20px rgba(211, 84, 0, 0.6);
            transform: rotate(5deg);
        }
        
        .logo-circle-text {
            color: white;
            font-weight: 800;
            font-size: 1.1rem;
            line-height: 1;
            letter-spacing: -0.5px;
        }
        
        .logo-text {
            display: flex;
            align-items: baseline;
        }
        
        .logo-kruzh {
            color: var(--gray-dark);
            font-weight: 700;
            font-size: 1.7rem;
            letter-spacing: -0.5px;
        }
        
        .logo-ok {
            color: var(--orange);
            font-weight: 800;
            font-size: 1.7rem;
            margin-left: 2px;
            letter-spacing: -0.5px;
        }
        
        /* Mobile logo adjustment */
        @media (max-width: 768px) {
            .logo-circle {
                width: 42px;
                height: 42px;
                margin-right: 10px;
            }
            
            .logo-circle-text {
                font-size: 1rem;
            }
            
            .logo-kruzh,
            .logo-ok {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .logo-circle {
                width: 38px;
                height: 38px;
                margin-right: 8px;
            }
            
            .logo-circle-text {
                font-size: 0.9rem;
            }
            
            .logo-kruzh,
            .logo-ok {
                font-size: 1.3rem;
            }
        }
        
        /* Rest of your existing CSS remains the same */
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--green-light) 0%, #ffffff 100%);
            padding: 3rem 1rem;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--gray-dark);
        }
        
        .hero p {
            font-size: 1.2rem;
            color: var(--gray-medium);
            margin-bottom: 2rem;
        }
        
        /* Search Bar - TripAdvisor style */
        .search-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .search-bar {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 1rem;
            align-items: end;
        }
        
        .search-input {
            position: relative;
        }
        
        .search-input input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .search-input input:focus {
            outline: none;
            border-color: var(--green-primary);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-medium);
        }
        
        .filter-select {
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            background: var(--white);
            cursor: pointer;
        }
        
        .search-btn {
            background: var(--green-primary);
            color: var(--white);
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .search-btn:hover {
            background: var(--green-dark);
        }
        
        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }
        
        /* Results Section */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .results-count {
            font-size: 1.2rem;
            color: var(--gray-medium);
        }
        
        .sort-select {
            padding: 0.5rem;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Loading and Error States */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--gray-medium);
            font-size: 1.1rem;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--green-light);
            border-radius: 50%;
            border-top-color: var(--green-primary);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            border-left: 4px solid #c62828;
        }
        
        .retry-btn {
            background: #c62828;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-top: 0.5rem;
            cursor: pointer;
        }
        
        /* Place Cards - TripAdvisor style */
        .place-card {
            background: var(--white);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
        }
        
        .place-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }
        
        .place-card-content {
            display: grid;
            grid-template-columns: 200px 1fr auto;
            gap: 1.5rem;
            padding: 1.5rem;
        }
        
        .place-image {
            width: 200px;
            height: 150px;
            border-radius: 8px;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            position: relative;
        }
        
        .place-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .place-card:hover .place-image img {
            transform: scale(1.05);
        }
        
        .place-info {
            flex: 1;
        }
        
        .place-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--gray-dark);
            line-height: 1.3;
        }
        
        /* Rating Stars - TripAdvisor style */
        .rating {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .stars {
            color: var(--green-primary);
            font-size: 1.2rem;
            margin-right: 0.5rem;
        }
        
        .rating-score {
            background: var(--green-dark);
            color: var(--white);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .reviews-count {
            color: var(--gray-medium);
            font-size: 0.9rem;
        }
        
        .place-meta {
            color: var(--gray-medium);
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        .place-meta p {
            margin-bottom: 0.3rem;
        }
        
        .place-features {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .feature-tag {
            background: var(--green-light);
            color: var(--green-dark);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .feature-tag:hover {
            background: var(--green-primary);
            color: var(--white);
        }
        
        .place-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .btn-primary {
            background: var(--green-primary);
            color: var(--white);
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            min-width: 120px;
        }
        
        .btn-primary:hover {
            background: var(--green-dark);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--green-dark);
            padding: 0.7rem 1.5rem;
            border: 2px solid var(--green-primary);
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .btn-secondary:hover {
            background: var(--green-light);
            transform: translateY(-1px);
        }
        
        .place-price {
            text-align: right;
            min-width: 120px;
        }
        
        .price-from {
            color: var(--gray-medium);
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }
        
        .price-amount {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--green-dark);
        }
        
        .price-period {
            color: var(--gray-medium);
            font-size: 0.9rem;
        }
        
        /* Map Sidebar */
        .map-sidebar {
            position: sticky;
            top: 2rem;
            height: fit-content;
        }
        
        #map {
            width: 100%;
            height: 400px;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid #e0e0e0;
        }
        
        .map-fallback {
            background: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-medium);
            font-size: 1rem;
            border-radius: 12px;
        }
        
        .map-legend {
            background: var(--gray-light);
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
            padding: 1rem;
        }
        
        .pagination-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--green-primary);
            background: white;
            color: var(--green-dark);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: var(--green-primary);
            color: white;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-info {
            color: var(--gray-medium);
        }
        
        /* No Results State */
        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--gray-medium);
        }
        
        .no-results-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        /* Responsive */
        @media (max-width: 968px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .place-card-content {
                grid-template-columns: 150px 1fr;
            }
            
            .place-price {
                grid-column: 1 / -1;
                text-align: left;
                margin-top: 1rem;
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            
            .price-amount {
                font-size: 1.3rem;
            }
        }
        
        @media (max-width: 768px) {
            .search-bar {
                grid-template-columns: 1fr;
            }
            
            .place-card-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 1rem;
            }
            
            .place-image {
                width: 100%;
                height: 200px;
            }
            
            .results-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .place-actions {
                justify-content: center;
            }
            
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .place-features {
                justify-content: center;
            }
            
            .place-actions {
                flex-direction: column;
            }
            
            .btn-primary, .btn-secondary {
                width: 100%;
            }
        }
    </style>
    
    <script src="https://api-maps.yandex.ru/2.1/?apikey=73a4825a-3afa-47c2-9241-df3665eaa73f&lang=ru_RU" type="text/javascript"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="#" class="logo">
                <div class="logo-circle">
                    <span class="logo-circle-text">OK</span>
                </div>
                <div class="logo-text">
                    <span class="logo-kruzh">–ö—Ä—É–∂</span>
                    <span class="logo-ok">–û–ö</span>
                </div>
            </a>
            <nav>
                <button class="btn-secondary" onclick="showOrganizerModal()">–î–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤</button>
            </nav>
        </div>
    </header>

    <!-- Rest of your HTML remains exactly the same -->
    <!-- Hero Section -->
    <section class="hero">
        <h1>–ù–∞–π–¥–∏—Ç–µ –ª—É—á—à–∏–µ –∫—Ä—É–∂–∫–∏ –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞</h1>
        <p>–ß–µ—Å—Ç–Ω—ã–µ –æ—Ç–∑—ã–≤—ã, —Ä–µ–π—Ç–∏–Ω–≥–∏ –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫</p>
        
        <div class="search-container">
            <div class="search-bar">
                <div class="search-input">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="–ö—Ä—É–∂–∫–∏, —Å–µ–∫—Ü–∏–∏, –∑–∞–Ω—è—Ç–∏—è...">
                </div>
                
                <select class="filter-select" id="categoryFilter">
                    <option value="">–í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</option>
                    <option value="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ</option>
                    <option value="–¢–≤–æ—Ä—á–µ—Å–∫–æ–µ">–¢–≤–æ—Ä—á–µ—Å–∫–æ–µ</option>
                    <option value="–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ">–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ</option>
                    <option value="–ù–∞—É—á–Ω–æ–µ">–ù–∞—É—á–Ω–æ–µ</option>
                    <option value="–Ø–∑—ã–∫–æ–≤–æ–µ">–Ø–∑—ã–∫–æ–≤–æ–µ</option>
                </select>
                
                <select class="filter-select" id="ageFilter">
                    <option value="">–õ—é–±–æ–π –≤–æ–∑—Ä–∞—Å—Ç</option>
                    <option value="3-5">3-5 –ª–µ—Ç</option>
                    <option value="6-8">6-8 –ª–µ—Ç</option>
                    <option value="9-12">9-12 –ª–µ—Ç</option>
                    <option value="13-17">13-17 –ª–µ—Ç</option>
                </select>
                
                <button class="search-btn" onclick="performSearch()">–ù–∞–π—Ç–∏</button>
            </div>
        </div>
    </section>

    <!-- Loading State -->
    <div id="loading" class="loading">
        <span class="loading-spinner"></span>
        –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—Ä—É–∂–∫–∏...
    </div>

    <!-- Error State -->
    <div id="error-message" class="error-message" style="display: none;">
        <strong>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</strong>
        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫—Ä—É–∂–∫–∞—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
        <button class="retry-btn" onclick="retryLoading()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Results Column -->
        <main class="results-column">
            <div class="results-header">
                <div class="results-count">–ù–∞–π–¥–µ–Ω–æ –∫—Ä—É–∂–∫–æ–≤: <span id="resultsCount">0</span></div>
                <select class="sort-select" id="sortSelect" onchange="performSearch()">
                    <option value="rating">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
                    <option value="name">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                    <option value="price">–ü–æ —Ü–µ–Ω–µ</option>
                </select>
            </div>
            
            <div id="resultsList" class="results-list">
                <!-- Results will be loaded here -->
            </div>

            <!-- No Results State -->
            <div id="noResults" class="no-results" style="display: none;">
                <div class="no-results-icon">üîç</div>
                <h3>–ö—Ä—É–∂–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="pagination" style="display: none;">
                <button class="pagination-btn" id="prevPage" onclick="changePage(-1)">‚Üê –ù–∞–∑–∞–¥</button>
                <span class="pagination-info" id="pageInfo">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
                <button class="pagination-btn" id="nextPage" onclick="changePage(1)">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
            </div>
        </main>
        
        <!-- Map Sidebar -->
        <aside class="map-sidebar">
            <div id="map" class="map-fallback">
                –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...
            </div>
            <div class="map-legend">
                <strong>–ö—Ä—É–∂–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ</strong>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—Ä—Ç—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫—Ä—É–∂–∫–æ–≤ —Ä—è–¥–æ–º —Å –≤–∞–º–∏</p>
            </div>
        </aside>
    </div>

    <!-- Your existing JavaScript remains exactly the same -->
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const AIRTABLE_API_KEY = 'patZudd3eZOcrhroz.b1307f7e37e3d583ff1750c59cc8291bfe3e9a8d2c1531d89350c38cee5a44ad';
        const AIRTABLE_BASE_ID = 'app8oCy3oQts8aPk3';
        const AIRTABLE_TABLE_NAME = 'Circles';
        const TALLY_FORM_URL = 'https://tally.so/r/mVg4Ol';

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let map;
        let placemarks = [];
        let allCircles = [];
        let currentPage = 1;
        const itemsPerPage = 4;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const loadingElement = document.getElementById('loading');
        const errorElement = document.getElementById('error-message');
        const resultsList = document.getElementById('resultsList');
        const resultsCount = document.getElementById('resultsCount');
        const noResults = document.getElementById('noResults');
        const pagination = document.getElementById('pagination');
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        const pageInfo = document.getElementById('pageInfo');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–∞–π—Ç–∞ –∫—Ä—É–∂–∫–∞
        function openWebsite(url, circleName) {
            if (!url || url.trim() === '') {
                alert(`–£ –∫—Ä—É–∂–∫–∞ "${circleName}" –ø–æ–∫–∞ –Ω–µ—Ç —Å–∞–π—Ç–∞`);
                return;
            }
            
            let websiteUrl = url.trim();
            
            // –£–¥–∞–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL
            websiteUrl = websiteUrl.replace(/\s+/g, '');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (!websiteUrl.startsWith('http://') && !websiteUrl.startsWith('https://')) {
                websiteUrl = 'https://' + websiteUrl;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å URL
            try {
                const validatedUrl = new URL(websiteUrl);
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–µ–Ω–∞
                if (!validatedUrl.hostname.includes('.')) {
                    throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–æ–º–µ–Ω');
                }
                
                console.log(`–û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–∞–π—Ç –∫—Ä—É–∂–∫–∞: ${validatedUrl.href}`);
                window.open(validatedUrl.href, '_blank', 'noopener,noreferrer');
                
            } catch (error) {
                console.error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL:', url, error);
                alert(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç –∫—Ä—É–∂–∫–∞ "${circleName}". –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–æ–±—â–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º.`);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
        function showLoading() {
            loadingElement.style.display = 'block';
            errorElement.style.display = 'none';
            noResults.style.display = 'none';
        }

        function hideLoading() {
            loadingElement.style.display = 'none';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            hideLoading();
            errorElement.style.display = 'block';
            errorElement.querySelector('p').textContent = message;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
        async function loadCirclesFromAirtable() {
            const url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`;
            
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Airtable...');
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} - ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π:', data.records?.length || 0);
                
                if (!data.records || data.records.length === 0) {
                    console.warn('–í Airtable –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π');
                    return getTestData();
                }
                
                return data.records.map(record => {
                    const fields = record.fields || {};
                    return {
                        id: record.id,
                        Name: fields.Name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                        Category: fields.Category || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                        AgeMin: fields.AgeMin || 0,
                        AgeMax: fields.AgeMax || 0,
                        Address: fields.Address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω',
                        Lat: fields.Lat || null,
                        Lon: fields.Lon || null,
                        Description: fields.Description || '',
                        Phone: fields.Phone || '',
                        Image: fields.Image || [],
                        IsActive: fields.IsActive !== false,
                        
                        // –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è —Å–∞–π—Ç–∞
                        Website: fields.Website || fields.URL || '',
                        
                        rating: (fields.rating || Math.random() * 2 + 3),
                        reviews: (fields.reviews || Math.floor(Math.random() * 50) + 5),
                        price: (fields.Price || fields.price || Math.floor(Math.random() * 5000) + 2000)
                    };
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                throw error;
            }
        }

        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        function getTestData() {
            return [
                {
                    id: 'test1',
                    Name: '–†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –¥–µ—Ç–µ–π',
                    Category: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ',
                    AgeMin: 6,
                    AgeMax: 12,
                    Address: '–ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 1',
                    Lat: 55.760181,
                    Lon: 37.617686,
                    IsActive: true,
                    rating: 4.5,
                    reviews: 23,
                    price: 4500,
                    Website: 'https://robot-school.example.com'
                },
                {
                    id: 'test2', 
                    Name: '–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–∞—è —Å—Ç—É–¥–∏—è "–ì—Ä–∞—Ü–∏—è"',
                    Category: '–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ',
                    AgeMin: 4,
                    AgeMax: 16,
                    Address: '–ú–æ—Å–∫–≤–∞, —É–ª. –ê—Ä–±–∞—Ç, 25',
                    Lat: 55.749602,
                    Lon: 37.590015,
                    IsActive: true,
                    rating: 4.8,
                    reviews: 34,
                    price: 3200,
                    Website: 'https://dance-gracia.example.ru'
                }
            ];
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
        function initMap() {
            try {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => createMap([position.coords.latitude, position.coords.longitude]),
                        error => {
                            console.warn('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:', error);
                            createMap([55.7558, 37.6173]);
                        },
                        { timeout: 5000 }
                    );
                } else {
                    createMap([55.7558, 37.6173]);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã:', error);
                document.getElementById('map').innerHTML = '<p>–ö–∞—Ä—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>';
            }
        }

        function createMap(center) {
            try {
                map = new ymaps.Map('map', { 
                    center: center, 
                    zoom: 11,
                    controls: ['zoomControl', 'fullscreenControl']
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã:', error);
                document.getElementById('map').className = 'map-fallback';
                document.getElementById('map').innerHTML = '–ö–∞—Ä—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç—É
        function addPlacemarks(circles) {
            if (!map) return;
            
            placemarks.forEach(mark => map.geoObjects.remove(mark));
            placemarks = [];
            
            const validCircles = circles.filter(circle => circle.Lat && circle.Lon);
            
            validCircles.forEach(circle => {
                try {
                    const placemark = new ymaps.Placemark([circle.Lat, circle.Lon], {
                        balloonContent: `
                            <strong>${circle.Name}</strong><br>
                            –†–µ–π—Ç–∏–Ω–≥: ${circle.rating.toFixed(1)} ‚≠ê<br>
                            ${circle.Address}<br>
                            <strong>${circle.price.toLocaleString()} ‚ÇΩ/–º–µ—Å</strong>
                        `
                    }, {
                        preset: 'islands#greenIcon'
                    });
                    
                    placemarks.push(placemark);
                    map.geoObjects.add(placemark);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ç–∫–∏:', error);
                }
            });
            
            if (placemarks.length > 0) {
                try {
                    map.setBounds(map.geoObjects.getBounds());
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥—Ä–∞–Ω–∏—Ü –∫–∞—Ä—Ç—ã:', error);
                }
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–≤–µ–∑–¥ —Ä–µ–π—Ç–∏–Ω–≥–∞
        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) stars += '‚òÖ';
            if (hasHalfStar) stars += '¬Ω';
            for (let i = stars.length; i < 5; i++) stars += '‚òÜ';
            
            return stars;
        }

        // –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        function performSearch() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const ageFilter = document.getElementById('ageFilter').value;
            const sortBy = document.getElementById('sortSelect').value;
            
            let filteredCircles = allCircles.filter(circle => {
                const matchesSearch = !searchText || 
                    circle.Name?.toLowerCase().includes(searchText) || 
                    circle.Description?.toLowerCase().includes(searchText);
                
                const matchesCategory = !category || circle.Category === category;
                
                let matchesAge = true;
                if (ageFilter) {
                    const [minAge, maxAge] = ageFilter.split('-').map(Number);
                    matchesAge = circle.AgeMin <= maxAge && circle.AgeMax >= minAge;
                }
                
                return matchesSearch && matchesCategory && matchesAge && circle.IsActive;
            });
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            filteredCircles.sort((a, b) => {
                switch(sortBy) {
                    case 'rating': return b.rating - a.rating;
                    case 'price': return a.price - b.price;
                    case 'name': return a.Name.localeCompare(b.Name);
                    default: return 0;
                }
            });
            
            currentPage = 1; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–æ–∏—Å–∫–µ
            displayCircles(filteredCircles);
        }

        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
        function changePage(direction) {
            currentPage += direction;
            performSearch(); // –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–∏—Å–∫ –¥–ª—è —Ç–µ–∫—É—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        }

        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            pageInfo.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}`;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—Ä—É–∂–∫–æ–≤
        function displayCircles(circles) {
            const totalItems = circles.length;
            resultsCount.textContent = totalItems;
            
            // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
            const startIndex = (currentPage - 1) * itemsPerPage;
            const paginatedCircles = circles.slice(startIndex, startIndex + itemsPerPage);
            
            updatePagination(totalItems);
            
            // –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            resultsList.innerHTML = '';
            
            if (paginatedCircles.length === 0) {
                noResults.style.display = 'block';
                addPlacemarks([]);
                return;
            }
            
            noResults.style.display = 'none';
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
            paginatedCircles.forEach(circle => {
                const card = document.createElement('div');
                card.className = 'place-card';
                
                card.innerHTML = `
                    <div class="place-card-content">
                        <div class="place-image">
                            ${circle.Image && circle.Image.length > 0 
                                ? `<img src="${circle.Image[0].url}" alt="${circle.Name}" 
                                     onerror="this.style.display='none'; this.parentNode.innerHTML='${circle.Name}'">`
                                : circle.Name || '–ö—Ä—É–∂–æ–∫'
                            }
                        </div>
                        
                        <div class="place-info">
                            <h3 class="place-title">${circle.Name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3>
                            
                            <div class="rating">
                                <span class="stars">${generateStars(circle.rating)}</span>
                                <span class="rating-score">${circle.rating.toFixed(1)}</span>
                                <span class="reviews-count">${circle.reviews} –æ—Ç–∑—ã–≤–æ–≤</span>
                            </div>
                            
                            <div class="place-meta">
                                <p><strong>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> ${circle.Category || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                                <p><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> ${circle.AgeMin || '?'}-${circle.AgeMax || '?'} –ª–µ—Ç</p>
                                <p><strong>–ê–¥—Ä–µ—Å:</strong> ${circle.Address || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                                ${circle.Website ? `<p><strong>–°–∞–π—Ç:</strong> ${circle.Website}</p>` : ''}
                            </div>
                            
                            <div class="place-features">
                                <span class="feature-tag">–ì—Ä—É–ø–ø—ã –¥–æ 8 —á–µ–ª–æ–≤–µ–∫</span>
                                <span class="feature-tag">–ü—Ä–æ–±–Ω—ã–π —É—Ä–æ–∫</span>
                                <span class="feature-tag">–°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ–¥–∞–≥–æ–≥–∏</span>
                            </div>
                            
                            <div class="place-actions">
                                <button class="btn-primary" onclick="openCircleDetail('${circle.id}', '${circle.Name}')">
                                    –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
                                </button>
                                ${circle.Website ? 
                                    `<button class="btn-secondary" onclick="openWebsite('${circle.Website}', '${circle.Name}')">
                                        –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                    </button>` :
                                    `<button class="btn-secondary" onclick="showCircleDetails('${circle.id}')">
                                        –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                    </button>`
                                }
                            </div>
                        </div>
                        
                        <div class="place-price">
                            <div class="price-from">–æ—Ç</div>
                            <div class="price-amount">${circle.price.toLocaleString()} ‚ÇΩ</div>
                            <div class="price-period">–≤ –º–µ—Å—è—Ü</div>
                        </div>
                    </div>
                `;
                
                resultsList.appendChild(card);
            });
            
            addPlacemarks(paginatedCircles);
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã –∑–∞–ø–∏—Å–∏
        function openCircleDetail(circleId, circleName) {
            window.open(`${TALLY_FORM_URL}?circle=${encodeURIComponent(circleName)}`, '_blank');
        }

        function showCircleDetails(circleId) {
            alert('–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫—Ä—É–∂–∫–µ');
        }

        function showOrganizerModal() {
            alert('–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –∫—Ä—É–∂–∫–∞ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ø–æ email: partner@kruzhok.ru');
        }

        function retryLoading() {
            errorElement.style.display = 'none';
            initializeApp();
        }

        // –ü–æ–∏—Å–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') performSearch();
        });

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        async function initializeApp() {
            showLoading();
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
                ymaps.ready(initMap);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                allCircles = await loadCirclesFromAirtable();
                console.log('–í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∫—Ä—É–∂–∫–æ–≤:', allCircles.length);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∫—Ä—É–∂–∫–∏
                displayCircles(allCircles);
                hideLoading();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>

