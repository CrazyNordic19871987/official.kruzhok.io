<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä—É–∂–æ–∫.OK - –ù–∞–π–¥–∏ –∫—Ä—É–∂–∫–∏ –¥–ª—è —Ä–µ–±–µ–Ω–∫–∞ –≤ –ú–æ—Å–∫–≤–µ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üë®‚Äçüéì</text></svg>">
    <!-- –ö–Ω–∏–≥–∞ -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">

<!-- –ú–æ–∑–≥ -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß†</text></svg>">

<!-- –ü–∞–ª–∏—Ç—Ä–∞ -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé®</text></svg>">

<!-- –†–æ–±–æ—Ç -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
    <style>
        /* –°–±—Ä–æ—Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ –∏ —à—Ä–∏—Ñ—Ç–æ–≤ */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã (–∫–∞–∫ —É Universe) */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background-color: #ffffff; /* –ë–µ–ª—ã–π —Ñ–æ–Ω –≤–º–µ—Å—Ç–æ —Å–µ—Ä–æ–≥–æ */
        color: #1a1a1a; /* –ì–ª—É–±–æ–∫–∏–π —á–µ—Ä–Ω—ã–π –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
        line-height: 1.5;
    }

    /* –•–µ–¥–µ—Ä –∫–∞–∫ —É Universe - —Å–≤–µ—Ç–ª—ã–π, —Å —Ç–æ–Ω–∫–æ–π –≥—Ä–∞–Ω–∏—Ü–µ–π */
    header {
        background-color: #fff;
        border-bottom: 1px solid #eaeaea;
        padding: 1.5rem 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    h1 {
        font-weight: 700;
        font-size: 1.8rem;
        text-align: center;
        margin-bottom: 1.5rem;
        background: linear-gradient(135deg, #4F46E5, #7E22CE); /* –ö—Ä–∞—Å–∏–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –±–æ–ª–µ–µ –≤–æ–∑–¥—É—à–Ω–∞—è */
    .search-bar {
        display: flex;
        gap: 12px;
        justify-content: center;
        max-width: 800px;
        margin: 0 auto;
        flex-wrap: wrap;
    }

    .search-bar input, .search-bar select {
        padding: 12px 16px;
        border: 1px solid #e1e5e9;
        border-radius: 12px; /* –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã –∫–∞–∫ —É Universe */
        font-size: 1rem;
        flex: 1;
        min-width: 200px;
        transition: all 0.2s ease;
    }

    .search-bar input:focus, .search-bar select:focus {
        outline: none;
        border-color: #4F46E5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .search-bar button {
        padding: 12px 24px;
        background: #4F46E5;
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .search-bar button:hover {
        background: #4338CA;
    }

    /* –ö–∞—Ä—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ */
    #map {
        width: 100%;
        height: 50vh; /* 50% –≤—ã—Å–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞ */
        min-height: 400px;
        border-radius: 0 0 16px 16px;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
    .results-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }

    .results-container h2 {
        font-weight: 600;
        margin-bottom: 1.5rem;
        font-size: 1.4rem;
    }

    /* –°–ï–¢–ö–ê –ö–ê–†–¢–û–ß–ï–ö - –ö–ê–ö –£ UNIVERSE */
    .results-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
    }

    /* –ö–ê–†–¢–û–ß–ö–ê - –û–°–ù–û–í–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï */
    .place-card {
        background: white;
        border-radius: 16px; /* –ë–æ–ª—å—à–æ–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
        overflow: hidden; /* –ß—Ç–æ–±—ã —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–ª–∏ */
        box-shadow: 0 2px 8px rgba(0,0,0,0.06); /* –¢–æ–Ω–∫–∞—è, –ª–µ–≥–∫–∞—è —Ç–µ–Ω—å */
        border: 1px solid #f0f0f0;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .place-card:hover {
        transform: translateY(-4px); /* –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–¥–Ω—è—Ç–∏—è */
        box-shadow: 0 8px 25px rgba(0,0,0,0.12); /* –£—Å–∏–ª–µ–Ω–Ω–∞—è —Ç–µ–Ω—å –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    }

    /* –ú–µ—Å—Ç–æ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞) */
    .place-image {
    width: 100%;
    height: 180px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    overflow: hidden; /* –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É */
}

    .place-content {
        padding: 1.5rem;
    }

    .place-content h3 {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .place-meta {
        color: #64748b; /* –°–µ—Ä—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –º–µ—Ç–∞-–∏–Ω—Ñ–æ */
        font-size: 0.9rem;
        margin-bottom: 1rem;
        line-height: 1.4;
    }

    /* –ö–Ω–æ–ø–∫–∞ - –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è */
    .place-card button {
        width: 100%;
        padding: 12px;
        background: #f8fafc;
        color: #4F46E5;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .place-card button:hover {
        background: #4F46E5;
        color: white;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media (max-width: 768px) {
        .search-bar { flex-direction: column; }
        .search-bar input, .search-bar select { min-width: auto; }
        .results-list { grid-template-columns: 1fr; }
        #map { height: 40vh; }
    }
</style>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=73a4825a-3afa-47c2-9241-df3665eaa73f&lang=ru_RU" type="text/javascript"></script>
</head>
<body>
    <header>
        <h1>–ö—Ä—É–∂–æ–∫.OK</h1>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞...">
            <select id="categoryFilter">
                <option value="">–í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</option>
                <option value="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ</option>
                <option value="–¢–≤–æ—Ä—á–µ—Å–∫–æ–µ">–¢–≤–æ—Ä—á–µ—Å–∫–æ–µ</option>
                <option value="–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ">–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ</option>
                <option value="–ù–∞—É—á–Ω–æ–µ">–ù–∞—É—á–Ω–æ–µ</option>
                <option value="–Ø–∑—ã–∫–æ–≤–æ–µ">–Ø–∑—ã–∫–æ–≤–æ–µ</option>
            </select>
            <button onclick="performSearch()">–ù–∞–π—Ç–∏</button>
        </div>
    </header>

    <main>
        <div id="map"></div>
        
        <div class="results-container">
            <h2>–ù–∞–π–¥–µ–Ω–æ –∫—Ä—É–∂–∫–æ–≤: <span id="resultsCount">0</span></h2>
            <div id="resultsList" class="results-list"></div>
        </div>
    </main>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Airtable
        const AIRTABLE_API_KEY = 'patZudd3eZOcrhroz.b1307f7e37e3d583ff1750c59cc8291bfe3e9a8d2c1531d89350c38cee5a44ad';
        const AIRTABLE_BASE_ID = 'app8oCy3oQts8aPk3';
        const AIRTABLE_TABLE_NAME = 'Circles';
        const TALLY_FORM_URL = 'https://tally.so/r/mVg4Ol';

        let map;
        let placemarks = [];
        let allCircles = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Airtable
        async function loadCirclesFromAirtable() {
            const url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`;
            try {
                const response = await fetch(url, { headers: { 'Authorization': `Bearer ${AIRTABLE_API_KEY}` } });
                const data = await response.json();
                return data.records.map(record => ({ id: record.id, ...record.fields }));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                return [];
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => createMap([position.coords.latitude, position.coords.longitude]),
                    error => createMap([55.7558, 37.6173])
                );
            } else {
                createMap([55.7558, 37.6173]);
            }
        }

        function createMap(center) {
            map = new ymaps.Map('map', { center: center, zoom: 11 });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç—É
        function addPlacemarks(circles) {
            placemarks.forEach(mark => map.geoObjects.remove(mark));
            placemarks = [];
            circles.forEach(circle => {
                if (circle.Lat && circle.Lon) {
                    const placemark = new ymaps.Placemark([circle.Lat, circle.Lon], {
                        balloonContent: `<strong>${circle.Name}</strong><br>${circle.Address}`
                    });
                    placemarks.push(placemark);
                    map.geoObjects.add(placemark);
                }
            });
            if (placemarks.length > 0) map.setBounds(map.geoObjects.getBounds());
        }

        // –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        function performSearch() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const filteredCircles = allCircles.filter(circle => {
                const matchesSearch = circle.Name?.toLowerCase().includes(searchText) || circle.Description?.toLowerCase().includes(searchText);
                const matchesCategory = !category || circle.Category === category;
                return matchesSearch && matchesCategory && circle.IsActive;
            });
            displayCircles(filteredCircles);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—Ä—É–∂–∫–æ–≤
        function displayCircles(circles) {
            document.getElementById('resultsCount').textContent = circles.length;
            addPlacemarks(circles);
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            circles.forEach(circle => {
                const card = document.createElement('div');
                card.className = 'place-card';
                card.innerHTML = `
    <div class="place-image">
        ${circle.Image && circle.Image.length > 0 
            ? `<img src="${circle.Image[0].url}" alt="${circle.Name}" style="width:100%; height:100%; object-fit:cover;">`
            : circle.Name || '–ö—Ä—É–∂–æ–∫'
        }
    </div>
    <div class="place-content">
        <h3>${circle.Name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3>
        ...
    </div>
`;
                resultsList.appendChild(card);
            });
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã –∑–∞–ø–∏—Å–∏
        function openCircleDetail(circleId, circleName) {
            window.open(`${TALLY_FORM_URL}?circle=${encodeURIComponent(circleName)}`, '_blank');
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async () => {
            ymaps.ready(initMap);
            allCircles = await loadCirclesFromAirtable();
            displayCircles(allCircles);
        });
    </script>
</body>
</html>
