<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Кружок.OK - Найди кружки для ребенка в Москве</title>
    <style>
        /* Сброс стандартных отступов и шрифтов */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* Подключаем современные шрифты (как у Universe) */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background-color: #ffffff; /* Белый фон вместо серого */
        color: #1a1a1a; /* Глубокий черный для текста */
        line-height: 1.5;
    }

    /* Хедер как у Universe - светлый, с тонкой границей */
    header {
        background-color: #fff;
        border-bottom: 1px solid #eaeaea;
        padding: 1.5rem 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    h1 {
        font-weight: 700;
        font-size: 1.8rem;
        text-align: center;
        margin-bottom: 1.5rem;
        background: linear-gradient(135deg, #4F46E5, #7E22CE); /* Красивый градиент */
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* Поисковая строка - более воздушная */
    .search-bar {
        display: flex;
        gap: 12px;
        justify-content: center;
        max-width: 800px;
        margin: 0 auto;
        flex-wrap: wrap;
    }

    .search-bar input, .search-bar select {
        padding: 12px 16px;
        border: 1px solid #e1e5e9;
        border-radius: 12px; /* Скругленные углы как у Universe */
        font-size: 1rem;
        flex: 1;
        min-width: 200px;
        transition: all 0.2s ease;
    }

    .search-bar input:focus, .search-bar select:focus {
        outline: none;
        border-color: #4F46E5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .search-bar button {
        padding: 12px 24px;
        background: #4F46E5;
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .search-bar button:hover {
        background: #4338CA;
    }

    /* Карта занимает больше места */
    #map {
        width: 100%;
        height: 50vh; /* 50% высоты экрана */
        min-height: 400px;
        border-radius: 0 0 16px 16px;
    }

    /* Контейнер результатов */
    .results-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }

    .results-container h2 {
        font-weight: 600;
        margin-bottom: 1.5rem;
        font-size: 1.4rem;
    }

    /* СЕТКА КАРТОЧЕК - КАК У UNIVERSE */
    .results-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
    }

    /* КАРТОЧКА - ОСНОВНОЕ ИЗМЕНЕНИЕ */
    .place-card {
        background: white;
        border-radius: 16px; /* Большое скругление */
        overflow: hidden; /* Чтобы скругления работали */
        box-shadow: 0 2px 8px rgba(0,0,0,0.06); /* Тонкая, легкая тень */
        border: 1px solid #f0f0f0;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .place-card:hover {
        transform: translateY(-4px); /* Эффект поднятия */
        box-shadow: 0 8px 25px rgba(0,0,0,0.12); /* Усиленная тень при наведении */
    }

    /* Место для картинки (пока заглушка) */
    .place-image {
        width: 100%;
        height: 180px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* Красивый градиент-заглушка */
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
    }

    .place-content {
        padding: 1.5rem;
    }

    .place-content h3 {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .place-meta {
        color: #64748b; /* Серый текст для мета-инфо */
        font-size: 0.9rem;
        margin-bottom: 1rem;
        line-height: 1.4;
    }

    /* Кнопка - более современная */
    .place-card button {
        width: 100%;
        padding: 12px;
        background: #f8fafc;
        color: #4F46E5;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .place-card button:hover {
        background: #4F46E5;
        color: white;
    }

    /* Адаптивность для мобильных */
    @media (max-width: 768px) {
        .search-bar { flex-direction: column; }
        .search-bar input, .search-bar select { min-width: auto; }
        .results-list { grid-template-columns: 1fr; }
        #map { height: 40vh; }
    }
</style>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=73a4825a-3afa-47c2-9241-df3665eaa73f&lang=ru_RU" type="text/javascript"></script>
</head>
<body>
    <header>
        <h1>Кружок.OK</h1>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Например, робототехника...">
            <select id="categoryFilter">
                <option value="">Все направления</option>
                <option value="Техническое">Техническое</option>
                <option value="Творческое">Творческое</option>
                <option value="Спортивное">Спортивное</option>
                <option value="Научное">Научное</option>
                <option value="Языковое">Языковое</option>
            </select>
            <button onclick="performSearch()">Найти</button>
        </div>
    </header>

    <main>
        <div id="map"></div>
        
        <div class="results-container">
            <h2>Найдено кружков: <span id="resultsCount">0</span></h2>
            <div id="resultsList" class="results-list"></div>
        </div>
    </main>

    <script>
        // Конфигурация Airtable
        const AIRTABLE_API_KEY = 'patZudd3eZOcrhroz.b1307f7e37e3d583ff1750c59cc8291bfe3e9a8d2c1531d89350c38cee5a44ad';
        const AIRTABLE_BASE_ID = 'app8oCy3oQts8aPk3';
        const AIRTABLE_TABLE_NAME = 'Circles';
        const TALLY_FORM_URL = 'https://tally.so/r/mVg4Ol';

        let map;
        let placemarks = [];
        let allCircles = [];

        // Загрузка данных из Airtable
        async function loadCirclesFromAirtable() {
            const url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`;
            try {
                const response = await fetch(url, { headers: { 'Authorization': `Bearer ${AIRTABLE_API_KEY}` } });
                const data = await response.json();
                return data.records.map(record => ({ id: record.id, ...record.fields }));
            } catch (error) {
                console.error('Ошибка загрузки данных:', error);
                return [];
            }
        }

        // Инициализация карты
        function initMap() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => createMap([position.coords.latitude, position.coords.longitude]),
                    error => createMap([55.7558, 37.6173])
                );
            } else {
                createMap([55.7558, 37.6173]);
            }
        }

        function createMap(center) {
            map = new ymaps.Map('map', { center: center, zoom: 11 });
        }

        // Добавление меток на карту
        function addPlacemarks(circles) {
            placemarks.forEach(mark => map.geoObjects.remove(mark));
            placemarks = [];
            circles.forEach(circle => {
                if (circle.Lat && circle.Lon) {
                    const placemark = new ymaps.Placemark([circle.Lat, circle.Lon], {
                        balloonContent: `<strong>${circle.Name}</strong><br>${circle.Address}`
                    });
                    placemarks.push(placemark);
                    map.geoObjects.add(placemark);
                }
            });
            if (placemarks.length > 0) map.setBounds(map.geoObjects.getBounds());
        }

        // Поиск и фильтрация
        function performSearch() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const filteredCircles = allCircles.filter(circle => {
                const matchesSearch = circle.Name?.toLowerCase().includes(searchText) || circle.Description?.toLowerCase().includes(searchText);
                const matchesCategory = !category || circle.Category === category;
                return matchesSearch && matchesCategory && circle.IsActive;
            });
            displayCircles(filteredCircles);
        }

        // Отображение кружков
        function displayCircles(circles) {
            document.getElementById('resultsCount').textContent = circles.length;
            addPlacemarks(circles);
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            circles.forEach(circle => {
                const card = document.createElement('div');
                card.className = 'place-card';
                card.innerHTML = `
                    <h3>${circle.Name || 'Без названия'}</h3>
                    <p><strong>Направление:</strong> ${circle.Category || 'Не указано'}</p>
                    <p><strong>Возраст:</strong> ${circle.AgeMin || '?'}-${circle.AgeMax || '?'} лет</p>
                    <p><strong>Адрес:</strong> ${circle.Address || 'Не указан'}</p>
                    <button onclick="openCircleDetail('${circle.id}', '${circle.Name}')">Записаться на пробное</button>
                `;
                resultsList.appendChild(card);
            });
        }

        // Открытие формы записи
        function openCircleDetail(circleId, circleName) {
            window.open(`${TALLY_FORM_URL}?circle=${encodeURIComponent(circleName)}`, '_blank');
        }

        // Запуск приложения после загрузки страницы
        document.addEventListener('DOMContentLoaded', async () => {
            ymaps.ready(initMap);
            allCircles = await loadCirclesFromAirtable();
            displayCircles(allCircles);
        });
    </script>
</body>
</html>
